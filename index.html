<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Minecraft Stats</title>
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    .stats {
      border: 2px solid #00bfff;
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      margin: auto;
      background: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 10px #00bfff99;
    }
    h2 {
      color: #00e5ff;
    }
    .stat {
      margin: 10px 0;
      font-size: 18px;
    }
  </style>
</head>
<body>

<div class="stats">
  <h2>ðŸŸ¢ Minecraft Stats</h2>
  <div class="stat">Online: <span id="online">--</span></div>
  <div class="stat">24h Peak: <span id="peak24h">--</span></div>
  <div class="stat">All-Time Peak: <span id="alltime">--</span></div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Your Firebase config - update with your real values
  const firebaseConfig = {
    apiKey: "AIzaSyBQCpQ0Hpze2o1iqPHzDl-yfYWQAeohSGQ",
    authDomain: "mc-server-stats-c9e35.firebaseapp.com",
    databaseURL: "https://mc-server-stats-c9e35-default-rtdb.firebaseio.com",
    projectId: "mc-server-stats-c9e35",
    storageBucket: "mc-server-stats-c9e35.appspot.com",
    messagingSenderId: "843071322483",
    appId: "1:843071322483:web:094c645a3fa167cfcb2d06"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const API_URL = 'https://api.mcstatus.io/v2/status/java/185.246.211.231:17708';

  async function fetchStats() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      const online = data.players.online || 0;

      document.getElementById('online').textContent = online;

      // Read existing stats from Firebase
      const snapshot = await db.ref('/stats').once('value');
      let stats = snapshot.val() || { peak24h: 0, alltime: 0, timestamp: 0 };

      const now = Date.now();

      // Reset 24h peak if more than 24h passed
      if (now - stats.timestamp > 24 * 60 * 60 * 1000) {
        stats.peak24h = online;
        stats.timestamp = now;
      } else if (online > stats.peak24h) {
        stats.peak24h = online;
      }

      // Update all-time peak
      if (online > stats.alltime) {
        stats.alltime = online;
      }

      // Write updated stats back to Firebase
      await db.ref('/stats').set(stats);

      // Update the display
      document.getElementById('peak24h').textContent = stats.peak24h;
      document.getElementById('alltime').textContent = stats.alltime;

    } catch (e) {
      console.error('Error fetching stats:', e);
      // Optionally show an error on the page
    }
  }

  fetchStats();
  setInterval(fetchStats, 10000); // Update every 10 seconds
</script>

</body>
</html>
